//
//  YelpClient.swift
//  yelp
//
//  Created by sanket patel on 9/19/14.
//  Copyright (c) 2014 sanket patel. All rights reserved.
//

import Foundation
import UIKit

class YelpClient: BDBOAuth1RequestOperationManager {
    var accessToken: String!
    var accessSecret: String!
    var searchResults: [SearchResult]? {
        
        didSet {
            
            println("search done")
            NSNotificationCenter.defaultCenter().postNotificationName("searchFinished", object: self)
        }
    }
    
    required init(coder aDecoder: NSCoder) {
        super.init(coder: aDecoder)
    }
    init(consumerKey key: String!, consumerSecret secret: String!, accessToken: String!, accessSecret: String!) {
        self.accessToken = accessToken
        self.accessSecret = accessSecret
        var baseUrl = NSURL(string: "http://api.yelp.com/v2/")
        super.init(baseURL: baseUrl, consumerKey: key, consumerSecret: secret);
        var token = BDBOAuthToken(token: accessToken, secret: accessSecret, expiration: nil)
        self.requestSerializer.saveAccessToken(token)
    }
    
    func search(term: String, radius: Int = 160, sort: Int = 0, categories: String = "", location: String = "San Francisco", limit: Int = 10) {
        
        println("searching for : \(term)")
        var parameters = ["term": term, "location": location, "limit": limit, "sort": sort, "radius_filter": radius, "category_filter": categories]
        println("\(parameters)")
        var data = self.GET("search", parameters: parameters, success: { (operation, response) -> Void in
            
            var object = response as NSDictionary
            var businesses = object["businesses"] as [NSDictionary]
            let mapped = businesses.map({ (business: NSDictionary) -> SearchResult in
                
                SearchResult(dict: business)
            })
            
            self.searchResults = mapped
            
            }) { (operation, error) -> Void in
                
                self.searchResults = []
                println(error)
        }
    }
    
    func searchWithTerm(term: String, success: (AFHTTPRequestOperation!, AnyObject!) -> Void, failure: (AFHTTPRequestOperation!, NSError!) -> Void) -> AFHTTPRequestOperation! {
        // For additional parameters, see http://www.yelp.com/developers/documentation/v2/search_api
        var parameters = ["term": term, "location": "San Francisco"]
        return self.GET("search", parameters: parameters, success: success, failure: failure)
    }
    
    class func supportedCategories() -> [String] {
        
        var categories = ["Amateur Sports Teams", "Aquariums", "Archery", "Beaches", "Bike Rentals", "Boating", "Bowling", "Climbing", "Disc Golf", "Diving", "Fishing", "Fitness & Instruction", "Go Karts", "Golf", "Gun/Rifle Ranges", "Hiking", "Horse Racing", "Horseback Riding", "Lakes", "Leisure Centers", "Mini Golf", "Mountain Biking", "Paintball", "Parks", "Playgrounds", "Rafting/Kayaking", "Recreation Centers", "Rock Climbing", "Skating Rinks", "Skydiving", "Soccer", "Sports Clubs", "Summer Camps", "Surfing", "Swimming Pools", "Tennis", "Zoos", "Arcades", "Art Galleries", "Botanical Gardens", "Casinos", "Cinema", "Festivals", "Jazz & Blues", "Museums", "Music Venues", "Opera & Ballet", "Performing Arts", "Professional Sports Teams", "Psychics & Astrologers", "Social Clubs", "Stadiums & Arenas", "Wineries", "Auto Detailing", "Auto Glass Services", "Auto Parts & Supplies", "Auto Repair", "Body Shops", "Car Dealers", "Car Stereo Installation", "Car Wash", "Gas & Service Stations", "Motorcycle Dealers", "Motorcycle Repair", "Oil Change Stations", "Parking", "RV Dealers", "Smog Check Stations", "Tires", "Towing", "Truck Rental", "Windshield Installation & Repair", "Barbers", "Cosmetics & Beauty Supply", "Day Spas", "Eyelash Service", "Hair Extensions", "Hair Removal", "Hair Salons", "Makeup Artists", "Massage", "Medical Spas", "Nail Salons", "Piercing", "Rolfing", "Skin Care", "Tanning", "Tattoo", "Adult Education", "Colleges & Universities", "Educational Services", "Elementary Schools", "Middle Schools & High Schools", "Preschools", "Private Tutors", "Special Education", "Specialty Schools", "Test Preparation", "Tutoring Centers", "Boat Charters", "Cards & Stationery", "Caterers", "Clowns", "DJs", "Hotels", "Magicians", "Officiants", "Party & Event Planning", "Party Supplies", "Personal Chefs", "Photographers", "Venues & Event Spaces", "Videographers", "Wedding Planning", "Banks & Credit Unions", "Check Cashing/Pay-day Loans", "Financial Advising", "Insurance", "Investing", "Tax Services", "Bagels", "Bakeries", "Beer, Wine & Spirits", "Breweries", "Butcher", "Coffee & Tea", "Convenience Stores", "Desserts", "Do-It-Yourself Food", "Donuts", "Farmers Market", "Food Delivery Services", "Grocery", "Ice Cream & Frozen Yogurt", "Internet Cafes", "Juice Bars & Smoothies", "Specialty Food", "Street Vendors", "Tea Rooms", "Wineries", "Acupuncture", "Cannabis Clinics", "Chiropractors", "Counseling & Mental Health", "Dentists", "Doctors", "Home Health Care", "Hospice", "Hospitals", "Laser Eye Surgery/Lasik", "Massage Therapy", "Medical Centers", "Medical Spas", "Midwives", "Nutritionists", "Optometrists", "Physical Therapy", "Reflexology", "Rehabilitation Center", "Retirement Homes", "Speech Therapists", "Traditional Chinese Medicine", "Urgent Care", "Weight Loss Centers", "Building Supplies", "Carpet Installation", "Carpeting", "Contractors", "Electricians", "Flooring", "Garage Door Services", "Gardeners", "Handyman", "Heating & Air Conditioning/HVAC", "Home Cleaning", "Home Inspectors", "Home Organization", "Home Theatre Installation", "Interior Design", "Internet Service Providers", "Keys & Locksmiths", "Landscape Architects", "Landscaping", "Lighting Fixtures & Equipment", "Masonry/Concrete", "Movers", "Painters", "Plumbing", "Pool Cleaners", "Real Estate", "Roofing", "Security Systems", "Shades & Blinds", "Solar Installation", "Television Service Providers", "Tree Services", "Window Washing", "Windows Installation", "Airports", "Bed & Breakfast", "Campgrounds", "Car Rental", "Guest Houses", "Hostels", "Hotels", "Motorcycle Rental", "RV Rental", "Ski Resorts", "Tours", "Transportation", "Travel Services", "Vacation Rental Agents", "Vacation Rentals", "Appliances & Repair", "Bail Bondsmen", "Bike Repair/Maintenance", "Carpet Cleaning", "Child Care & Day Care", "Community Service/Non-Profit", "Couriers & Delivery Services", "Dry Cleaning & Laundry", "Electronics Repair", "Funeral Services & Cemeteries", "Furniture Reupholstery", "IT Services & Computer Repair", "Junk Removal and Hauling", "Notaries", "Pest Control", "Printing Services", "Recording & Rehearsal Studios", "Recycling Center", "Screen Printing", "Screen Printing/T-Shirt Printing", "Self Storage", "Sewing & Alterations", "Shipping Centers", "Shoe Repair", "Snow Removal", "Watch Repair", "Print Media", "Radio Stations", "Television Stations", "Adult Entertainment", "Bars", "Comedy Clubs", "Dance Clubs", "Jazz & Blues", "Karaoke", "Music Venues", "Pool Halls", "Animal Shelters", "Horse Boarding", "Pet Services", "Pet Stores", "Veterinarians", "Accountants", "Advertising", "Architects", "Boat Repair", "Career Counseling", "Employment Agencies", "Graphic Design", "Internet Service Providers", "Lawyers", "Life Coach", "Marketing", "Office Cleaning", "Private Investigation", "Public Relations", "Video/Film Production", "Web Design", "Departments of Motor Vehicles", "Landmarks & Historical Buildings", "Libraries", "Police Departments", "Post Offices", "Apartments", "Home Staging", "Mortgage Brokers", "Property Management", "Real Estate Agents", "Real Estate Services", "University Housing", "Buddhist Temples", "Churches", "Hindu Temples", "Mosques", "Synagogues", "Afghan", "African", "American (New)", "American (Traditional)", "Argentine", "Asian Fusion", "Barbeque", "Basque", "Belgian", "Brasseries", "Brazilian", "Breakfast & Brunch", "British", "Buffets", "Burgers", "Burmese", "Cafes", "Cajun/Creole", "Cambodian", "Caribbean", "Cheesesteaks", "Chicken Wings", "Chinese", "Creperies", "Cuban", "Delis", "Diners", "Ethiopian", "Fast Food", "Filipino", "Fish & Chips", "Fondue", "Food Stands", "French", "Gastropubs", "German", "Gluten-Free", "Greek", "Halal", "Hawaiian", "Himalayan/Nepalese", "Hot Dogs", "Hungarian", "Indian", "Indonesian", "Irish", "Italian", "Japanese", "Korean", "Kosher", "Latin American", "Live/Raw Food", "Malaysian", "Mediterranean", "Mexican", "Middle Eastern", "Modern European", "Mongolian", "Moroccan", "Pakistani", "Persian/Iranian", "Peruvian", "Pizza", "Polish", "Portuguese", "Russian", "Salad", "Sandwiches", "Scandinavian", "Seafood", "Singaporean", "Soul Food", "Soup", "Southern", "Spanish", "Steakhouses", "Sushi Bars", "Taiwanese", "Tapas Bars", "Tapas/Small Plates", "Tex-Mex", "Thai", "Turkish", "Ukrainian", "Vegan", "Vegetarian", "Vietnamese", "Adult", "Antiques", "Art Galleries", "Arts & Crafts", "Baby Gear & Furniture", "Books, Mags, Music and Video", "Bridal", "Computers", "Cosmetics & Beauty Supply", "Department Stores", "Discount Store", "Drugstores", "Electronics", "Eyewear & Opticians", "Fashion", "Fireworks", "Flowers & Gifts", "Guns & Ammo", "Hobby Shops", "Home & Garden", "Jewelry", "Knitting Supplies", "Luggage", "Mobile Phones", "Musical Instruments & Teachers", "Office Equipment", "Outlet Stores", "Pawn Shops", "Personal Shopping", "Photography Stores & Services", "Shopping Centers", "Sporting Goods", "Thrift Stores", "Tobacco Shops", "Toy Stores", "Watches", "Wholesale Stores"]
        
        return categories
    }
    
    class func getApiCategory(categoy: String) -> String {
    
        let apiCategories = ["Amateur Sports Teams":"amateursportsteams","Aquariums":"aquariums","Archery":"archery","Beaches":"beaches","Bike Rentals":"bikerentals","Boating":"boating","Bowling":"bowling","Climbing":"climbing","Disc Golf":"discgolf","Diving":"diving","Fishing":"fishing","Fitness & Instruction":"fitness","Go Karts":"gokarts","Golf":"golf","Gun/Rifle Ranges":"gun_ranges","Hiking":"hiking","Horse Racing":"horseracing","Horseback Riding":"horsebackriding","Lakes":"lakes","Leisure Centers":"leisure_centers","Mini Golf":"mini_golf","Mountain Biking":"mountainbiking","Paintball":"paintball","Parks":"parks","Playgrounds":"playgrounds","Rafting/Kayaking":"rafting"]
            
            /*
            "Recreation Centers":"recreation","Rock Climbing":"rock_climbing","Skating Rinks":"skatingrinks","Skydiving":"skydiving","Soccer":"football","Sports Clubs":"sports_clubs","Summer Camps":"summer_camps","Surfing":"surfing","Swimming Pools":"swimmingpools","Tennis":"tennis","Zoos":"zoos","Arcades":"arcades","Art Galleries":"galleries","Botanical Gardens":"gardens","Casinos":"casinos","Cinema":"movietheaters","Festivals":"festivals","Jazz & Blues":"jazzandblues","Museums":"museums","Music Venues":"musicvenues","Opera & Ballet":"opera","Performing Arts":"theater","Professional Sports Teams":"sportsteams","Psychics & Astrologers":"psychic_astrology","Social Clubs":"social_clubs","Stadiums & Arenas":"stadiumsarenas","Wineries":"wineries","Auto Detailing":"auto_detailing","Auto Glass Services":"autoglass","Auto Parts & Supplies":"autopartssupplies","Auto Repair":"autorepair","Body Shops":"bodyshops","Car Dealers":"car_dealers","Car Stereo Installation":"stereo_installation","Car Wash":"carwash","Gas & Service Stations":"servicestations","Motorcycle Dealers":"motorcycledealers","Motorcycle Repair":"motorcyclerepair","Oil Change Stations":"oilchange","Parking":"parking","RV Dealers":"rv_dealers","Smog Check Stations":"smog_check_stations","Tires":"tires","Towing":"towing","Truck Rental":"truck_rental","Windshield Installation & Repair":"windshieldinstallrepair","Barbers":"barbers","Cosmetics & Beauty Supply":"cosmetics","Day Spas":"spas","Eyelash Service":"eyelashservice","Hair Extensions":"hair_extensions","Hair Removal":"hairremoval","Hair Salons":"hair","Makeup Artists":"makeupartists","Massage":"massage","Medical Spas":"medicalspa","Nail Salons":"othersalons","Piercing":"piercing","Rolfing":"rolfing","Skin Care":"skincare","Tanning":"tanning","Tattoo":"tattoo","Adult Education":"adultedu","Colleges & Universities":"collegeuniv","Educational Services":"educationservices","Elementary Schools":"elementaryschools","Middle Schools & High Schools":"highschools","Preschools":"preschools","Private Tutors":"privatetutors","Special Education":"specialed","Specialty Schools":"specialtyschools","Test Preparation":"testprep","Tutoring Centers":"tutoring","Boat Charters":"boatcharters","Cards & Stationery":"stationery","Caterers":"catering","Clowns":"clowns","DJs":"djs","Hotels":"hotels","Magicians":"magicians","Officiants":"officiants","Party & Event Planning":"eventplanning","Party Supplies":"partysupplies","Personal Chefs":"personalchefs","Photographers":"photographers","Venues & Event Spaces":"venues","Videographers":"videographers","Wedding Planning":"wedding_planning","Banks & Credit Unions":"banks","Check Cashing/Pay-day Loans":"paydayloans","Financial Advising":"financialadvising","Insurance":"insurance","Investing":"investing","Tax Services":"taxservices","Bagels":"bagels","Bakeries":"bakeries","Beer, Wine & Spirits":"beer_and_wine","Breweries":"breweries","Butcher":"butcher","Coffee & Tea":"coffee","Convenience Stores":"convenience","Desserts":"desserts","Do-It-Yourself Food":"diyfood","Donuts":"donuts","Farmers Market":"farmersmarket","Food Delivery Services":"fooddeliveryservices","Grocery":"grocery","Ice Cream & Frozen Yogurt":"icecream","Internet Cafes":"internetcafe","Juice Bars & Smoothies":"juicebars","Specialty Food":"gourmet","Street Vendors":"streetvendors","Tea Rooms":"tea","Wineries":"wineries","Acupuncture":"acupuncture","Cannabis Clinics":"cannabis_clinics","Chiropractors":"chiropractors","Counseling & Mental Health":"c_and_mh","Dentists":"dentists","Doctors":"physicians","Home Health Care":"homehealthcare","Hospice":"hospice","Hospitals":"hospitals","Laser Eye Surgery/Lasik":"laserlasikeyes","Massage Therapy":"massage_therapy","Medical Centers":"medcenters","Medical Spas":"medicalspa","Midwives":"midwives","Nutritionists":"nutritionists","Optometrists":"optometrists","Physical Therapy":"physicaltherapy","Reflexology":"reflexology","Rehabilitation Center":"rehabilitation_center","Retirement Homes":"retirement_homes","Speech Therapists":"speech_therapists","Traditional Chinese Medicine":"tcm","Urgent Care":"urgent_care","Weight Loss Centers":"weightlosscenters","Building Supplies":"buildingsupplies","Carpet Installation":"carpetinstallation","Carpeting":"carpeting","Contractors":"contractors","Electricians":"electricians","Flooring":"flooring","Garage Door Services":"garage_door_services","Gardeners":"gardeners","Handyman":"handyman","Heating & Air Conditioning/HVAC":"hvac","Home Cleaning":"homecleaning","Home Inspectors":"home_inspectors","Home Organization":"home_organization","Home Theatre Installation":"hometheatreinstallation","Interior Design":"interiordesign","Internet Service Providers":"isps","Keys & Locksmiths":"locksmiths","Landscape Architects":"landscapearchitects","Landscaping":"landscaping","Lighting Fixtures & Equipment":"lighting","Masonry/Concrete":"masonry_concrete","Movers":"movers","Painters":"painters","Plumbing":"plumbing","Pool Cleaners":"poolcleaners","Real Estate":"realestate","Roofing":"roofing","Security Systems":"securitysystems","Shades & Blinds":"blinds","Solar Installation":"solarinstallation","Television Service Providers":"televisionserviceproviders","Tree Services":"treeservices","Window Washing":"windowwashing","Windows Installation":"windowsinstallation","Airports":"airports","Bed & Breakfast":"bedbreakfast","Campgrounds":"campgrounds","Car Rental":"carrental","Guest Houses":"guesthouses","Hostels":"hostels","Hotels":"hotels","Motorcycle Rental":"motorcycle_rental","RV Rental":"rvrental","Ski Resorts":"skiresorts","Tours":"tours","Transportation":"transport","Travel Services":"travelservices","Vacation Rental Agents":"vacationrentalagents","Vacation Rentals":"vacation_rentals","Appliances & Repair":"homeappliancerepair","Bail Bondsmen":"bailbondsmen","Bike Repair/Maintenance":"bike_repair_maintenance","Carpet Cleaning":"carpet_cleaning","Child Care & Day Care":"childcare","Community Service/Non-Profit":"nonprofit","Couriers & Delivery Services":"couriers","Dry Cleaning & Laundry":"drycleaninglaundry","Electronics Repair":"electronicsrepair","Funeral Services & Cemeteries":"funeralservices","Furniture Reupholstery":"reupholstery","IT Services & Computer Repair":"itservices","Junk Removal and Hauling":"junkremovalandhauling","Notaries":"notaries","Pest Control":"pest_control","Printing Services":"copyshops","Recording & Rehearsal Studios":"recording_studios","Recycling Center":"recyclingcenter","Screen Printing":"screenprinting","Screen Printing/T-Shirt Printing":"screen_printing_tshirt_printing","Self Storage":"selfstorage","Sewing & Alterations":"sewingalterations","Shipping Centers":"shipping_centers","Shoe Repair":"shoerepair","Snow Removal":"snowremoval","Watch Repair":"watch_repair","Print Media":"printmedia","Radio Stations":"radiostations","Television Stations":"televisionstations","Adult Entertainment":"adultentertainment","Bars":"bars","Comedy Clubs":"comedyclubs","Dance Clubs":"danceclubs","Jazz & Blues":"jazzandblues","Karaoke":"karaoke","Music Venues":"musicvenues","Pool Halls":"poolhalls","Animal Shelters":"animalshelters","Horse Boarding":"horse_boarding","Pet Services":"petservices","Pet Stores":"petstore","Veterinarians":"vet","Accountants":"accountants","Advertising":"advertising","Architects":"architects","Boat Repair":"boatrepair","Career Counseling":"careercounseling","Employment Agencies":"employmentagencies","Graphic Design":"graphicdesign","Internet Service Providers":"isps","Lawyers":"lawyers","Life Coach":"lifecoach","Marketing":"marketing","Office Cleaning":"officecleaning","Private Investigation":"privateinvestigation","Public Relations":"publicrelations","Video/Film Production":"videofilmproductions","Web Design":"web_design","Departments of Motor Vehicles":"departmentsofmotorvehicles","Landmarks & Historical Buildings":"landmarks","Libraries":"libraries","Police Departments":"policedepartments","Post Offices":"postoffices","Apartments":"apartments","Home Staging":"homestaging","Mortgage Brokers":"mortgagebrokers","Property Management":"propertymgmt","Real Estate Agents":"realestateagents","Real Estate Services":"realestatesvcs","University Housing":"university_housing","Buddhist Temples":"buddhist_temples","Churches":"churches","Hindu Temples":"hindu_temples","Mosques":"mosques","Synagogues":"synagogues","Afghan":"afghani","African":"african","American (New)":"newamerican","American (Traditional)":"tradamerican","Argentine":"argentine","Asian Fusion":"asianfusion","Barbeque":"bbq","Basque":"basque","Belgian":"belgian","Brasseries":"brasseries","Brazilian":"brazilian","Breakfast & Brunch":"breakfast_brunch","British":"british","Buffets":"buffets","Burgers":"burgers","Burmese":"burmese","Cafes":"cafes","Cajun/Creole":"cajun","Cambodian":"cambodian","Caribbean":"caribbean","Cheesesteaks":"cheesesteaks","Chicken Wings":"chicken_wings","Chinese":"chinese","Creperies":"creperies","Cuban":"cuban","Delis":"delis","Diners":"diners","Ethiopian":"ethiopian","Fast Food":"hotdogs","Filipino":"filipino","Fish & Chips":"fishnchips","Fondue":"fondue","Food Stands":"foodstands","French":"french","Gastropubs":"gastropubs","German":"german","Gluten-Free":"gluten_free","Greek":"greek","Halal":"halal","Hawaiian":"hawaiian","Himalayan/Nepalese":"himalayan","Hot Dogs":"hotdog","Hungarian":"hungarian","Indian":"indpak","Indonesian":"indonesian","Irish":"irish","Italian":"italian","Japanese":"japanese","Korean":"korean","Kosher":"kosher","Latin American":"latin","Live/Raw Food":"raw_food","Malaysian":"malaysian","Mediterranean":"mediterranean","Mexican":"mexican","Middle Eastern":"mideastern","Modern European":"modern_european","Mongolian":"mongolian","Moroccan":"moroccan","Pakistani":"pakistani","Persian/Iranian":"persian","Peruvian":"peruvian","Pizza":"pizza","Polish":"polish","Portuguese":"portuguese","Russian":"russian","Salad":"salad","Sandwiches":"sandwiches","Scandinavian":"scandinavian","Seafood":"seafood","Singaporean":"singaporean","Soul Food":"soulfood","Soup":"soup","Southern":"southern","Spanish":"spanish","Steakhouses":"steak","Sushi Bars":"sushi","Taiwanese":"taiwanese","Tapas Bars":"tapas","Tapas/Small Plates":"tapasmallplates","Tex-Mex":"tex-mex","Thai":"thai","Turkish":"turkish","Ukrainian":"ukrainian","Vegan":"vegan","Vegetarian":"vegetarian","Vietnamese":"vietnamese","Adult":"adult","Antiques":"antiques","Art Galleries":"galleries","Arts & Crafts":"artsandcrafts","Baby Gear & Furniture":"baby_gear","Books, Mags, Music and Video":"media","Bridal":"bridal","Computers":"computers","Cosmetics & Beauty Supply":"cosmetics","Department Stores":"deptstores","Discount Store":"discountstore","Drugstores":"drugstores","Electronics":"electronics","Eyewear & Opticians":"opticians","Fashion":"fashion","Fireworks":"fireworks","Flowers & Gifts":"flowers","Guns & Ammo":"guns_and_ammo","Hobby Shops":"hobbyshops","Home & Garden":"homeandgarden","Jewelry":"jewelry","Knitting Supplies":"knittingsupplies","Luggage":"luggage","Mobile Phones":"mobilephones","Musical Instruments & Teachers":"musicalinstrumentsandteachers","Office Equipment":"officeequipment","Outlet Stores":"outlet_stores","Pawn Shops":"pawn","Personal Shopping":"personal_shopping","Photography Stores & Services":"photographystores","Shopping Centers":"shoppingcenters","Sporting Goods":"sportgoods","Thrift Stores":"thrift_stores","Tobacco Shops":"tobaccoshops","Toy Stores":"toys","Watches":"watches","Wholesale Stores":"wholesale_stores"] */
        
        return apiCategories[categoy] ?? ""
    
    }
    
    class func combine(list: [String], separator: String = ",") -> String {
    
        var str : String = ""
        for (idx, item) in enumerate(list) {
            str += "\(item)"
            if idx < list.count-1 {
                str += separator
            }
        }
        
        return str
    }
    
}